(function(){var b=function(d,e){return function(){return d.apply(e,arguments)}},a=Object.prototype.hasOwnProperty,c=function(g,e){for(var d in e){if(a.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f;g.__super__=e.prototype;return g};Annotator.Plugin.Tags=(function(){c(d,Annotator.Plugin);function d(){this.setAnnotationTags=b(this.setAnnotationTags,this);this.updateField=b(this.updateField,this);d.__super__.constructor.apply(this,arguments)}d.prototype.field=null;d.prototype.input=null;d.prototype.pluginInit=function(){if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({label:"Add some tags here\u2026",load:this.updateField,submit:this.setAnnotationTags});this.annotator.viewer.addField({load:this.updateViewer});if(this.annotator.plugins.Filter){this.annotator.plugins.Filter.addFilter({label:"Tag",property:"tags",isFiltered:Annotator.Plugin.Tags.filterCallback})}return this.input=$(this.field).find(":input")};d.prototype.parseTags=function(f){var e;f=$.trim(f);e=[];if(f){e=f.split(/\s+/)}return e};d.prototype.stringifyTags=function(e){return e.join(" ")};d.prototype.updateField=function(g,e){var f;f="";if(e.tags){f=this.stringifyTags(e.tags)}return this.input.val(f)};d.prototype.setAnnotationTags=function(f,e){return e.tags=this.parseTags(this.input.val())};d.prototype.updateViewer=function(f,e){f=$(f);if(e.tags&&$.isArray(e.tags)&&e.tags.length){return f.addClass("annotator-tags").html(function(){var g;return g=$.map(e.tags,function(h){return'<span class="annotator-tag">'+Annotator.$.escape(h)+"</span>"}).join(" ")})}else{return f.remove()}};return d})();Annotator.Plugin.Tags.filterCallback=function(k,l){var i,h,g,m,f,e,j,d;if(l==null){l=[]}g=0;h=[];if(k){h=k.split(/\s+/g);for(f=0,j=h.length;f<j;f++){i=h[f];if(l.length){for(e=0,d=l.length;e<d;e++){m=l[e];if(m.indexOf(i)!==-1){g+=1}}}}}return g===h.length}}).call(this);